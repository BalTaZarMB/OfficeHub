const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-0NgBIML-.js","assets/index-CP9bbISh.js","assets/vue-CE51Rq-N.js","assets/arco-CSlgBs8T.js","assets/index-DgS3TR8z.css","assets/index-BHrxhp-L.css","assets/index-BVdvKeVh.css","assets/index-Mb2FwH0E.css","assets/index-6rnfXikd.css","assets/index-8er2yjEK.css","assets/index-CD0PvSSd.css","assets/index-DMsf4HX_.css","assets/index-AiJAGXR2.css","assets/index-CmHRKhBm.css","assets/index-BdBJDoqm.js","assets/dom-w3hEyMar.js","assets/index-DLevhAQE.js","assets/dataModel-BAnfpXEG.js","assets/editor-erg3WYaJ.js","assets/file-5T113FlP.js","assets/dom2imgBlob-9Y9ueTAB.js","assets/mitt-DRzrVJO_.js","assets/regexp-get-flags-C7Uvd9jb.js","assets/index.esm-CMCG6-Sp.js","assets/index-DcbzwQnB.css","assets/index-BjBdBAHx.css","assets/kbDirBar-DYROCkZi.js","assets/tool-Bo2ff5vQ.js","assets/tool-DKhUqd2f.css","assets/kbDirBar-C1IvEP8y.css","assets/index-saoVbYNb.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./index-DTTWDj9t.js";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang-BjN5Q8E7.js";import{u as t,k as i,g as l,d as s,_ as o,b as n}from"./index-CP9bbISh.js";/* empty css              *//* empty css              */import{i as d,r}from"./paging-DIzHhPFZ.js";/* empty css              *//* empty css              *//* empty css              */import{c,I as u}from"./index.module-j6bqOxnK.js";import{a as p}from"./dataModel-BAnfpXEG.js";import{H as v,k as _,B as m,l as g,M as h,I as f}from"./arco-CSlgBs8T.js";import{d as x,r as j,a as y,c as b,n as w,u as k,l as C,m as V,$ as I,s as D,j as T,y as B,x as E,q as H,a3 as R,a4 as O,k as W,W as L}from"./vue-CE51Rq-N.js";import{f as P}from"./entry-Bl8EDNG_.js";import"./index.vue_vue_type_script_setup_true_lang-B-7UBCTw.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index-CVht5qs2.js";import"./index.esm-CMCG6-Sp.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./editor-erg3WYaJ.js";var A="/files/";const M=n(x({__name:"KbDetails",props:{uid:{},tid:{},catalogData:{}},emits:["handleChangeData","handleView"],setup(e,{expose:a,emit:n}){const d=R((()=>o((()=>import("./index-0NgBIML-.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])))),r=R((()=>o((()=>import("./index-BdBJDoqm.js").then((e=>e.bx))),__vite__mapDeps([14,1,2,3,4,15,16,17,18,19,20,21,22,23,24,6,7,25,11])))),h=R((()=>o((()=>import("./kbDirBar-DYROCkZi.js")),__vite__mapDeps([26,1,2,3,4,27,28,29,30,25])))),f=e,x=t(),O=j(!1),W=j(!1),L=j(),P=j([]),M=j(!1),S=j(!0),z=j([]),$=j([]),q=j(""),F=y({a:111}),G=j(),K=j(),N=y({page:1,total:0}),Q=j(),U=n,J=j(""),X=j(""),Y=b((()=>J.value||f.uid)),Z=b((()=>X.value||f.tid)),ee=b((()=>f.catalogData)),ae=async e=>{const{tid:a,uid:t}=e;X.value!=a&&(U("handleView"),X.value=a,J.value=t,window.scrollTo({top:0,behavior:"smooth"}),i("tid",a),oe(1,ie))},te=async e=>{G.value=e,Object.assign(F,{}),z.value=[],oe()},ie=async(e,a)=>{try{const e=((e=[])=>{const a=["h2","h3","h4","h5"];return null==e?void 0:e.map((e=>"header"===e.type&&e.data.level>1&&{id:e.id,tag:a[e.data.level-2],text:e.data.text})).filter(Boolean)})(K.value);$.value=e}catch(t){}W.value=!0,O.value=!0},le=e=>{Object.assign(F,e)},se=()=>{},oe=async(e=1,a)=>{var t,i,o;S.value=!0;const n={tid:Z.value,uid:Y.value},d=await p(n);S.value=!1;const r={...d.data},c=[],u=r.schema;let v;u.forEach(((e,a)=>{"pageLine"===e.type&&c.push(a)})),c.length&&(v=1==e?u.slice(0,c[0]):u.slice(c[e-2]+1,c[e-1])),r.schema=v||u;const _={...d,data:{...r},total:c.length,page:e};c.length?(N.page=e,N.total=c.length):(N.page=1,N.total=0),d.status&&"1"===d.status&&(null==(t=l())?void 0:t.uid)&&(null==(i=l())?void 0:i.uid)!==x.userId&&(location.href=`${A}forbiddenPage`),q.value=d.title||(null==(o=l())?void 0:o.title)||"",K.value=d.data.schema||[],U("handleChangeData",{title:d.title,vt:d.vt,hasFav:!1,tid:""}),((e,a)=>{var t,i;const l=a?[...e.schema]:[...P.value,...e.schema];G.value.blocks.render({blocks:l}),P.value=l,z.value=(null==(t=e.config)?void 0:t.bar)||[],Object.assign(F,(null==(i=e.config)?void 0:i.waterConfig)||{})})(_.data,e<2),s({title:d.title,desc:""}),a&&a()},ne=()=>{oe(N.page+1)};return a({editorRef:G}),(e,a)=>{const t=v,i=u,l=_,s=m,o=g;return T(),w("div",{class:D(I(c).editWrap)},[k(t,{"offset-top":80,style:{position:"absolute",left:"20px"}},{default:C((()=>[V("div",{class:D(I(c).leftBar)},[k(I(h),{dir:I($),dirCatalog:I(ee),onHandleCatalogItemClick:ae},null,8,["dir","dirCatalog"])],2)])),_:1}),V("div",{class:D(I(c).previewWrap),ref_key:"docRef",ref:L},[k(I(d),{visible:I(M),value:I(F),onHandleWaterChange:le,onHandleWaterModalClose:se},{default:C((()=>[k(o,{id:"pageContent",style:{margin:"0 20px",position:"relative",overflow:"hidden",padding:"20px","border-radius":"6px","min-height":"700px"},class:"colorBgContainer pubCol"},{default:C((()=>[I(S)?(T(),w("div",{key:0,class:D(I(c).isLoadingBox)},[k(l,{loading:I(S),tip:"文档加载中..."},{icon:C((()=>[k(i)])),_:1},8,["loading"])],2)):(T(),w("div",{key:1,class:D(I(c).titleIpt)},B(I(q)),3)),k(I(r),{minHeight:60,readOnly:!0,onGetEditorInstance:te,onHandleEditorChange:ie}),I(N).total&&I(N).total>=I(N).page?(T(),w("div",{key:2,ref_key:"pagationRef",ref:Q,style:{"text-align":"center"}},[k(s,{type:"primary",onClick:ne},{default:C((()=>[E("当前为第"+B(I(N).page)+"页，共"+B(I(N).total+1)+"页",1)])),_:1})],512)):H("",!0)])),_:1})])),_:1},8,["visible","value"])],2)],2)}}}),[["__scopeId","data-v-2e94e0b6"]]),S={homeView:"_homeView_exb68_1",pwdBox:"_pwdBox_exb68_5",wrapper:"_wrapper_exb68_10",logo:"_logo_exb68_14",icon:"_icon_exb68_17",headTitle:"_headTitle_exb68_20",headSubTitle:"_headSubTitle_exb68_26"};var z="",$="橙子轻文档";const q={class:"logo60"},F=["src"],G={class:"flx-ce-bet w100"},K=n(x({__name:"index",setup(t){const s=z,o=$,n=j(),c=j(),u=j(""),p=j(""),v=j(""),_=j(!1),g=j([]),x=y({isPreview:!0}),b=async()=>{var e;try{const a=await P(null==(e=l())?void 0:e.id,{pwd:u.value});_.value=!1,p.value=a.list.length>0?a.list[0].tid:"",v.value=a.uid,g.value=a.list||[],i("tid",p.value)}catch(a){"503"==a.status&&(_.value=!0,h.error("需要填写访问密码进行访问！"))}},H=async()=>{b()},R=()=>{var e;null==(e=c.value)||e.handleResetView(),A("1")},A=e=>{"2"===e?d():r()},K=e=>{Object.assign(x,e)};return O((()=>{(async()=>{b()})()})),(t,i)=>{const l=a,d=f,r=m,h=e;return I(_)?(T(),w("div",{key:0,class:D(["flx-ce-ce",I(S).pwdBox])},[V("div",{class:D(I(S).wrapper)},[V("div",{class:D(["flx-ce-ce",I(S).logo])},[V("div",q,[I(s)?(T(),w("img",{key:0,src:I(s),alt:"logo",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,F)):(T(),W(l,{key:1,icon:"fluent-emoji-flat:tangerine",class:D(I(S).icon)},null,8,["class"]))]),V("div",null,[V("div",{class:D(I(S).headTitle)},B(I(o)),3),V("div",{class:D(I(S).headSubTitle)},"让知识创作更简单",2)])],2),V("div",G,[k(d,{style:{"margin-right":"10px"},class:D(["newInput",I(S).activationCode]),modelValue:I(u),"onUpdate:modelValue":i[0]||(i[0]=e=>L(u)?u.value=e:null),placeholder:"请输入文档密码",size:"large","allow-clear":""},null,8,["class","modelValue"]),k(r,{type:"primary",size:"large",class:"btn",onClick:H},{default:C((()=>i[1]||(i[1]=[E("提交")]))),_:1})])],2)],2)):(T(),w("div",{key:1,class:D(I(S).homeView)},[k(h,{ref_key:"headerRef",ref:c,onHandleViewChange:A,dataInfo:I(x)},null,8,["dataInfo"]),k(M,{ref_key:"editorComRef",ref:n,onHandleChangeData:K,onHandleView:R,tid:I(p),uid:I(v),catalogData:I(g)},null,8,["tid","uid","catalogData"])],2))}}}),[["__scopeId","data-v-99305920"]]);export{K as default};
