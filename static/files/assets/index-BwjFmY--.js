import{_ as e}from"./index-tS2fN0Zd.js";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang-CQpENLI4.js";import"./index-CP9bbISh.js";/* empty css              */import{T as l,m as t}from"./index.vue_vue_type_script_setup_true_lang-B-7UBCTw.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index-CVht5qs2.js";import{c as s,d as i,e as o}from"./entry-Bl8EDNG_.js";import{M as d,I as n,F as r,R as u,O as p,m,t as c,u as f,b as _,j as y}from"./arco-CSlgBs8T.js";import{d as v,r as g,a as x,c as j,j as w,n as h,u as b,$ as k,l as V,m as U,y as R,k as q,q as I,F as O,O as z,x as C,W as F,B as M}from"./vue-CE51Rq-N.js";/* empty css              *//* empty css              *//* empty css              */import"./index.vue_vue_type_script_setup_true_lang-BjN5Q8E7.js";import"./index.esm-CMCG6-Sp.js";import"./mitt-DRzrVJO_.js";const N={apiConfig:{apiUrl:"/doc/wiki/list",params:{keyword:""}},pagination:!0,size:"large",columns:[{title:"名称",dataIndex:"title",align:"left",width:350},{title:"最近访问",dataIndex:"vt",align:"left",ellipsis:!0,tooltip:!0,type:"time"},{title:"文件数",dataIndex:"num",align:"left",ellipsis:!0,tooltip:!0}],operation:[{type:l.edit,btnName:"编辑"},{type:l.delete,btnName:"删除"}],data:[]},B=v({__name:"index",setup(l,{expose:v}){const B=g(),W=g(!1),Q=g([]),S=g([]),T=g(),$=g([]),A=x({title:"",icon:"",role:{key:"1",pwd:""},space:"",list:[],id:""}),D={tistatustle:[{required:!0,message:"请选择",trigger:"change"}],title:[{required:!0,message:"请输入"}],"role.pwd":[{required:!0,message:"请输入"}]},E=j((()=>A.id?"编辑知识库":"新建知识库")),G=async e=>{A.list=[],J()},H=async()=>{try{const e=await i({page:1,pagesize:1e3,keyword:"",type:"",space:""});Q.value=e.list.filter((e=>"dir"===e.type)),A.id&&J()}catch(e){}},J=async()=>{try{const e=await i({page:1,pagesize:1e3,keyword:"",type:"",space:A.space});S.value=e.list.filter((e=>"doc"===e.type))}catch(e){}},K=async()=>{if(await T.value.validate())return!1;try{const e=$.value.map((e=>S.value.find((a=>a.tid===e))));A.list=[...e],await o(A),B.value.setRefresh(),d.success("操作成功")}catch(e){}},L=()=>{T.value.resetFields(),$.value=[]};return v({tableRef:B,handleShowMk:async e=>{W.value=!0,M((async()=>{if(e){Object.assign(A,e);const a=await s(e.id),{list:l,space:t}=a;A.space=t||"",$.value=l.map((e=>e.tid))}else A.id="";H()}))}}),(l,s)=>{const i=a,o=n,d=r,v=e,g=u,x=p,j=m,M=c,H=f,J=_,P=y;return w(),h("div",null,[b(i,{ref_key:"tableRef",ref:B,schema:k(N)},null,8,["schema"]),b(P,{class:"initModal borderRadius",visible:k(W),"onUpdate:visible":s[6]||(s[6]=e=>F(W)?W.value=e:null),title:k(E),"ok-text":"创建","unmount-on-close":!0,"title-align":"start",onBeforeOk:K,onClose:L},{default:V((()=>[b(J,{ref_key:"formRef",ref:T,model:k(A),rules:D},{default:V((()=>[b(d,{field:"title",label:"标题","show-colon":""},{default:V((()=>[b(o,{modelValue:k(A).title,"onUpdate:modelValue":s[0]||(s[0]=e=>k(A).title=e),placeholder:"请输入标题"},null,8,["modelValue"])])),_:1}),b(d,{field:"icon",label:"图标","show-colon":""},{default:V((()=>[b(v,{imgUrl:k(A).icon,"onUpdate:imgUrl":s[1]||(s[1]=e=>k(A).icon=e),parentRef:k(T)},null,8,["imgUrl","parentRef"])])),_:1}),b(d,{field:"role.key",label:"访问控制","show-colon":""},{default:V((()=>[b(g,{modelValue:k(A).role.key,"onUpdate:modelValue":s[2]||(s[2]=e=>k(A).role.key=e),options:k(t)},{label:V((({data:e})=>[U("span",null,R(e.label),1)])),_:1},8,["modelValue","options"])])),_:1}),"2"===k(A).role.key?(w(),q(d,{key:0,field:"role.pwd",label:"访问密码","show-colon":""},{default:V((()=>[b(o,{modelValue:k(A).role.pwd,"onUpdate:modelValue":s[3]||(s[3]=e=>k(A).role.pwd=e),placeholder:"请设置访问密码"},null,8,["modelValue"])])),_:1})):I("",!0),b(d,{field:"space",label:"选择内容","show-colon":"","validate-trigger":["change","blur"]},{default:V((()=>[b(j,{class:"borderRadius",modelValue:k(A).space,"onUpdate:modelValue":s[4]||(s[4]=e=>k(A).space=e),placeholder:"请选择","allow-clear":"",onChange:G},{default:V((()=>[(w(!0),h(O,null,z(k(Q),(e=>(w(),q(x,{key:e.tid,value:e.tid},{default:V((()=>[C(R(e.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(A).space?(w(),q(d,{key:1},{default:V((()=>[b(H,{modelValue:k($),"onUpdate:modelValue":s[5]||(s[5]=e=>F($)?$.value=e:null)},{default:V((()=>[(w(!0),h(O,null,z(k(S),(e=>(w(),q(M,{key:e.tid,value:e.tid},{default:V((()=>[C(R(e.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})):I("",!0)])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}});export{B as default};
